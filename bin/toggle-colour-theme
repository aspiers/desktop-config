#!/bin/bash

# NOTE: was previously using ~/.config/gnome-terminal-profile
# but now we're toggling multiple themes so need a generic
# light/dark state not just for gnome-terminal-profile.
THEME_FILE=~/.config/theme

# Initialize theme file if it doesn't exist (default to dark)
if [[ ! -f "$THEME_FILE" ]]; then
    echo "dark" > "$THEME_FILE"
fi

# Get the current theme - should be "light" or "dark"
old_theme=$(<"$THEME_FILE")

# Determine the opposite theme and set configuration variables
if [[ "$old_theme" == "light" ]]; then
    new_theme="dark"
    terminal_profile="Dark"
    xfce_theme="Greybird-geeko-dark"
else
    # For dark theme or invalid theme, default to light
    new_theme="light"
    terminal_profile="Bright"
    xfce_theme="Greybird-geeko"
fi

echo "Switching from ${old_theme:-undefined} to $new_theme theme"
notify-send -t 3000 "Switching to $new_theme theme"

# Update the theme file
echo "$new_theme" > "$THEME_FILE"

# Ensure apps like Chrome honour the theme setting
gsettings set org.gnome.desktop.interface color-scheme "prefer-$new_theme"

xfce4-terminal-config "$terminal_profile"
gnome-terminal-profile "$terminal_profile"

echo "Setting XFCE theme to $xfce_theme"
xfconf-query -c xsettings -p /Net/ThemeName -s "$xfce_theme"

echo "Setting emacs theme to $new_theme"
emacsclient -e "(as-set-theme \"$new_theme\")"
